name: Update README Age (October 30th Increment)

on:
  schedule:
    - cron: '0 0 30 10 *' 
  workflow_dispatch:

jobs:
  update-age:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Get current age from README
        id: get_age
        run: |
          CURRENT_AGE=$(grep 'Minha idade:' README.md | grep -oP 'Minha idade:\s*\K\d+')

          if [ -z "$CURRENT_AGE" ]; then
            echo "::error::'**Minha idade:**' marker followed by a number not found in README.md."
            echo "Please ensure your README.md has a line like 'Minha idade: 25'."
            exit 1
          fi

          echo "Current age found in README: $CURRENT_AGE"
          echo "current_age=$CURRENT_AGE" >> $GITHUB_OUTPUT

      - name: Calculate new age and update README
        run: |
          CURRENT_AGE=${{ steps.get_age.outputs.current_age }}
          AGE_INCREMENT=1
          NEW_AGE=$((CURRENT_AGE + AGE_INCREMENT))
          echo "Calculated new age: $NEW_AGE"
          sed -i "s/**Minha idade:**\s*[0-9]*/Minha idade: ${NEW_AGE}/" README.md
          if git diff --exit-code README.md; then
            echo "No changes detected in README.md. Skipping commit."
          else
            echo "Changes detected in README.md. Committing and pushing."
            git config user.name github-actions
            git config user.email github-actions@github.com
            git add README.md
            git commit -m "Automated: Increment age in README to ${NEW_AGE}"
            git push
          fi
